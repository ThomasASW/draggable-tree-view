!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return y}});var r=require("react"),n=e.n(r),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=n().createContext&&n().createContext(o),l=function(){return l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};function c(e){return e&&e.map((function(e,t){return n().createElement(e.tag,l({key:t},e.attr),c(e.child))}))}function d(e){return function(t){return n().createElement(s,l({attr:l({},e.attr)},t),c(e.child))}}function s(e){var t=function(t){var r,o=e.attr,a=e.size,c=e.title,d=i(e,["attr","size","title"]),s=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n().createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,d,{className:r,style:l(l({color:e.color||t.color},t.style),e.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),c&&n().createElement("title",null,c),e.children)};return void 0!==a?n().createElement(a.Consumer,null,(function(e){return t(e)})):t(o)}function u(e){return d({tag:"svg",attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"}}]})(e)}function g(e){return d({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41z"}}]})(e)}const f=({node:e,onDragStart:t,onDragOver:o,onDrop:a,onDelete:l,onDeleteError:i,removeNode:c,onEditNode:d,onEditNodeError:s,editNode:y,dragEnabled:p,readOnly:h})=>{const[m,v]=(0,r.useState)(!1),E=()=>{v(!m)},[O,N]=(0,r.useState)(!1),[S,b]=(0,r.useState)(!1),[D,w]=(0,r.useState)(e.title);(0,r.useEffect)((()=>{O&&x()}),[O]);const x=async()=>{m&&E(),await l(e)?c(e):i()};return n().createElement("div",{id:e.title,draggable:p&&!O&&!S,onDragStart:r=>{console.log(e,"drag started"),t(e,r)},onDragOver:t=>o(e,t),onDrop:t=>a(e,t)},n().createElement("div",{style:{display:"flex",alignItems:"center"}},n().createElement("span",{onClick:()=>{O||S||E()},style:{cursor:"pointer",marginRight:"10px"}},S?n().createElement("div",null,n().createElement("input",{id:"editNode",type:"text",placeholder:"New title",value:D,onChange:e=>{w(e.target.value)}}),n().createElement("button",{id:"editingNode",onClick:async()=>{await d(e,D)?y(e,D):s(),b(!1)}},"Save")):"",e.children.length>0&&m?n().createElement(g,{style:{marginLeft:"10px"}}):"",e.children.length>0&&!m?n().createElement(u,{style:{marginLeft:"10px"}}):"",0===e.children.length?n().createElement("i",{className:"fa",style:{marginLeft:"24px"}}):""," ",e.title)," "," ",h?n().createElement(n().Fragment,null):n().createElement(n().Fragment,null,n().createElement("i",{id:e.title+"del",className:"fa-solid fa-trash","data-testid":e.id+"delete",style:{color:"grey"},onClick:()=>{O||S||N(!0)}})," ",n().createElement("i",{id:e.title+"edit",className:"fas fa-edit","data-testid":e.id+"edit",style:{color:"dark grey"},onClick:()=>{O||S||(m&&E(),b(!0))}}))),m&&n().createElement("div",{style:{marginLeft:"20px"}},e.children&&e.children.length>0&&e.children.map((e=>n().createElement(f,{key:e.id,node:e,onDragStart:t,onDragOver:o,onDrop:a,onDelete:l,onDeleteError:i,removeNode:c,onEditNode:d,onEditNodeError:s,editNode:y,dragEnabled:p,readOnly:h})))))};var y=({addRef:e,fetchNodesUrl:t,addNodeUrl:o,reOrderNodeUrl:a,deleteNodeUrl:l,editNodeUrl:i,dragEnabled:c,readOnly:d})=>{const[s,u]=(0,r.useState)([]);(0,r.useEffect)((()=>{g()}),[]);const g=async()=>{try{const e=await fetch(t),r=await e.json();console.log(r),u(r)}catch(e){console.log(e)}},y=async e=>{try{400===(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e})})).status&&alert("Duplicate entry"),g()}catch(e){console.log(e)}};(0,r.useEffect)((()=>{e.current={addNodeFn:y}}),[y]);var p=!1,h=!1;const m=(e,t)=>{p||(console.log(e,"dragStart"),t.dataTransfer.setData("text/plain",JSON.stringify(e)),p=!0)},v=(e,t)=>{t.preventDefault(),console.log(e,"dragOver")},E=async(e,t)=>{if(t.preventDefault(),h)return;h=!0,console.log(e,"drop");const r=JSON.parse(t.dataTransfer.getData("text/plain"));try{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r.id,parentId:e.id})}),g()}catch(e){console.log(e),alert("Error rearranging nodes")}},O=(e,t)=>{for(let r=0;r<e.length;r++){if(e[r].id===t)return e.splice(r,1),u(e),!0;if(e[r].children&&e[r].children.length>0&&O(e[r].children,t))return u(e),!0}return!1},N=async e=>{const t={...e};try{await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){return console.log(e),!1}return!0},S=(e,t,r)=>{for(let n=0;n<e.length;n++){if(e[n].id===t)return e[n].title=r,u(e),!0;if(e[n].children&&e[n].children.length>0&&S(e[n].children,t,r))return u(e),!0}return!1},b=async(e,t)=>{const r={...e};try{r.title=t,await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){return console.log(e),!1}return!0};return n().createElement("div",null,s.map((e=>n().createElement(f,{key:e.id,node:e,onDragStart:m,onDragOver:v,onDrop:E,onDelete:N,onDeleteError:()=>alert("Error deleting node"),removeNode:e=>O([...s],e.id),onEditNode:b,onEditNodeError:()=>alert("Error editing node"),editNode:(e,t)=>S([...s],e.id,t),dragEnabled:c,readOnly:d}))))};module.exports=t}();